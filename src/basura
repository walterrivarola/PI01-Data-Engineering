from fastapi import FastAPI, File, UploadFile, responses
from fastapi.responses import JSONResponse
#import pandas as pd
#df = pd.read_json('./src/stream.json')


@app.get('/streams')
def list_stream():
    datos = next(db.fetch())
    return datos

@app.get('/streams/{sid}')
def get_stream(sid: str):
    stream = db.get(sid)
    if stream:
        return stream
    else:
        return JSONResponse({"message": "stream no encontrado"}, status_code=404)

@app.patch('/streams/{sid}')
def update_stream(sid: str, stu: UpdateStream):
    print(db.get(sid))
    updates = {k:v for k,v in stu.json().items() if v is not None}
    try:
        db.update(updates, sid)
        return db.get(sid)
    except Exception:
        return JSONResponse({"message": "stream no encontrado"}, status_code=404)

@app.delete('/streams/{sid}')
def delete_stream(sid: str):
    db.delete(sid)
    return 'Stream elimiado'